# J.  狂风呼啸，此时站在你面前的是一队真正的特种兵Ⅰ

### 思路和解法：

首先，简略概括本题要求，其实就是求一个排列方式，使得所有相同兵种的特种兵都排列在一起，并且让所得排列与原排列尽可能相同。

由于相同组的特种兵一定排列在一起，那么我们就不对单个特种兵枚举，而是枚举兵种的排列。

那么，这是一道DP题，如何转化为子问题呢？

思考的结果可以是，按照构造排列的方式来――构造一个排列，只需要在子排列（子问题）后面选取一个新元素。

那么，有**状态转移方程**
$$
dp[S]=max(dp[S \setminus \{i\}]+sum[r][i]-sum[l-1][i])   \quad 对于任意i \in S
$$
其中$sum[a][b]$代表1-a中的b的个数（前缀和）。

可见这里是人为地为集合建立了序（排列），那么集合如何表示呢？这里就是状态压缩了。

使用集合的二进制表示法，存在为1，不存在为0，那么每一位就可以表示一个元素的存在情况，考虑到兵种只有20种，可以使用一个32位integer解决空间问题。

那么**初始状态**是什么呢？显然$dp[\empty]=0$

那么如何保证子问题被预先处理呢？这里使用了**记忆化搜索**，用-1表示未处理。（K题使用的递推）

具体看代码，有注释

### 时间复杂度：

包含两部分**前缀和+初始化**等预处理部分和**DP**部分



前缀和+初始化部分$O(N)$



DP部分

枚举所有子元素是$O(M)$

关于代码中处理 L 和 R 的部分，一个可能不太紧的上界是 $O(M)$

所有集合数目是$O(2^M)$

那么DP的一个复杂度上界为$O(M^2 2^M)$



故总复杂度$O(N+M^2 2^M)$

### 空间复杂度：

前缀和数组 $O(NM)$

状态数组$O(2^M)$

总空间复杂度$O(NM+2^M)$