# N.  利姆露与魔法阵

### 题意理解：

INPUT：

第一组 结点个数 n，总操作个数 m。
第二组 各节点的初始权值(integer)
第三组 n-1条树上的无向边
第四组 m次操作

OUTPUT:

每个询问的结果（对170001取模）

### 思路和解法：

emmm，怎么说呢，树剖不完全板子题。

为什么不完全呢？是因为没有子树修改和求和。

大致总结一下

树剖大致有三种剖分方式：

1.重链剖分

2.长链剖分

3.实链剖分

然而我只学了第一种

那就稍微总结下吧

首先要明确重儿子的概念，一个节点任意一个子树节点数目最大的子节点叫做该节点重儿子，没被选上的都叫轻儿子。

所谓重链是除了根节点以外，以轻儿子开始，后面连续的重儿子形成的链。

在dfs时，dfs访问序列（dfs序）中子树的索引是连续的。但如果我们按照每次先搜索重儿子的策略，那么每条重链也是连续的。（当然根据选择的首先搜素的儿子不同就还有不同的剖分方式）

这样我们就可以在线段树上区间维护重链。

而利用重链，我们可以求得树上任意两点之间距离。

细节看代码，代码有注释

### 时间复杂度：

树剖预处理的过程是两次dfs，都是线性时间

树剖可以保证区间查询不超过$\log(N)$条链，每条链线段树$O(\log(N))$,那么单次查询$O(\log(N)^2)$

总为$O(M\log(N)^2)$

### 空间复杂度：

（看代码数组长度知空间复杂度x

$O( N )$