# R.  利姆露的魔法咒语库

### 思路和解法：

主席树（可是我不会 x

题意要求维护版本，但是如果每个版本一棵树，空间复杂度爆炸。

那么就有主席树，如下图所示

![persistent-seg](C:\Users\tungsten\Desktop\王正仁-2019081308021\R\persistent-seg.png)

可以看到主席树利用了以前的节点，从而只新建了$\log(N)$的新节点。

知道了主席树之后就去实现主席树。

像主席树和平衡树这样的动态能力强的数据结构和普通线段树很不同的一点在于这些数据结构喜欢开内存池。

当然代码内是用内存池实现的。详细见代码，代码有详细注释。

实现完毕后，我们用一个数组记录和一个计数器，分别记录每个版本的root和总版本数。就可以实现所有功能。

### 时间复杂度：

建树$O(N)$

单次新建版本$O(\log(N))$

总为$O(N+M\log(N))$

### 空间复杂度：

首先，初始版本需要$O(N)$的空间

每次新建一个版本需要$O(\log(N))$的空间

故总空间复杂度

$O( M\log(N)+N )$